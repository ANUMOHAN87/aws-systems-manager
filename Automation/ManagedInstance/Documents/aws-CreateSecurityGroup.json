{
  "schemaVersion": "0.3",
  "description": "Creates a security group that allows only RDP",
  "assumeRole": "{{AutomationAssumeRole}}",
  "parameters": {
	"AutomationAssumeRole": {
		"type": "String",
		"description": "The ARN of the role that allows Automation to perform the actions on your behalf",
		"default": ""
	},
	"LambdaAssumeRole": {
		"type": "String",
		"description": "The ARN of the role that allows Lambda created by Automation to perform the actions on your behalf",
		"default": "arn:aws:iam::{{global:ACCOUNT_ID}}:role/AutomationLambdaRole"
	},
    "GroupName": {
      "type": "String",
      "description": "(Required) Group Name to create."
    },
    "Platform": {
      "type": "String",
      "description": "(Required) Platform - Windows or Linux."
    }
   },
"mainSteps": [
    {
      "name": "makeLambdaStack",
      "action": "aws:createStack",
      "maxAttempts": 1,
      "onFailure": "Abort",
      "inputs": {
        "Capabilities": [
          "CAPABILITY_IAM"
        ],
        "StackName": "AutomationLambdaStack{{GroupName}}",
        "TemplateBody": "{0}",
        "TimeoutInMinutes": 5
      }
    },
    {
        "name": "invokeMyLambdaFunction",
        "action": "aws:invokeLambdaFunction",
        "maxAttempts": 3,
        "timeoutSeconds": 120,
        "onFailure": "Abort",
        "inputs": {
            "FunctionName": "Automation-{{GroupName}}",
            "Payload": "{\r\n  \"groupname\": \"{{GroupName}}\",\r\n  \"platform\" : \"{{Platform}}\"\r\n}"
        }
    },
    {
        "name":"deleteLambdaStack",
        "action":"aws:deleteStack",
        "maxAttempts":1,
        "onFailure":"Abort",
        "inputs":{
            "StackName":"AutomationLambdaStack{{GroupName}}"
        }
    }
 ]
}